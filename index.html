<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>VAMP Offline (HTML)</title>
  <link rel="stylesheet" href="./vamp.css"/>
</head>

<body>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     TOP BAR ‚Äî PRESERVED + NWU BRANDING
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="topbar">
  <div class="brand">
    <img src="./NWU-holding-shape-digital-white.png"
         alt="NWU"
         style="width:40px;height:40px;filter:drop-shadow(0 0 6px rgba(255,0,60,.6));"/>
    <div>
      <div class="title">VAMP Offline</div>
      <div class="muted">Virtual Academic Management Partner ‚Äî NWU</div>
    </div>
  </div>

  <div class="chips" id="statusChips">
    <span class="pill bad" id="chipProfile">Profile ‚ùå</span>
    <span class="pill bad" id="chipTA">TA ‚ùå</span>
    <span class="pill bad" id="chipExp">Expectations ‚ùå</span>
  </div>

  <div class="right" style="margin-left:auto;">
    <audio id="vampSound" src="./vamp.wav" preload="auto"></audio>
    <span class="pill" id="stagePill">Stage: Awaiting enrolment</span>
  </div>
</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     VAMP AGENT ‚Äî CENTRAL, ALWAYS PRESENT
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<section id="vamp-agent">

    <div class="vamp-video-frame">
      <video id="vamp-video"
        src="./vampire.mp4"
        preload="auto"
        muted
        playsinline>
      </video>
    <div class="vamp-glow"></div>
  </div>

  <div class="vamp-dialogue">

    <div class="vamp-identity">
      <h1 class="vamp-name">VAMP</h1>
      <div class="vamp-role">Your Performance Guide</div>
    </div>

    <!-- Floating dialogue bubbles -->
    <div id="vamp-bubbles" class="vamp-bubbles">
      <div class="vamp-bubble idle">
        Awaiting instruction‚Ä¶
      </div>
    </div>

    <!-- ALWAYS AVAILABLE Ask-VAMP -->
    <div class="ask-vamp">
      <textarea id="ask-vamp-input"
                placeholder="Ask VAMP for guidance, clarification, or support‚Ä¶"
                rows="2"></textarea>
      <button id="ask-vamp-btn" class="btn glow">
        Ask VAMP
      </button>
    </div>

  </div>
</section>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     ORIGINAL APP CONTAINER ‚Äî PRESERVED VERBATIM
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div class="container">

  <div class="tabs">
    <div class="tab active" data-tab="enrol">Enrolment</div>
    <div class="tab" data-tab="expectations">Expectations</div>
    <div class="tab" data-tab="evidence">Evidence Log</div>
    <div class="tab" data-tab="reports">Reports</div>
    <div class="tab" data-tab="voice">Voice Settings</div>
    <div class="tab" data-tab="logs">Logs</div>
  </div>

  <!-- ENROLMENT -->
  <section class="panel active" id="tab-enrol">
    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">Staff Enrolment</div>
          <div class="muted">Create/load your profile. This unlocks all actions.</div>
        </div>
        <div class="right">
          <span class="pill" id="profilePill">No profile loaded</span>
        </div>
      </div>

      <div class="form grid3">
        <div><label>Staff ID</label><input id="staffId"/></div>
        <div><label>Cycle year</label><input id="cycleYear" value="2025"/></div>
        <div><label>Name</label><input id="name"/></div>
        <div><label>Position</label><input id="position"/></div>
        <div><label>Faculty</label><input id="faculty"/></div>
        <div><label>Manager</label><input id="manager"/></div>
      </div>

      <div class="row" style="margin-top:12px;">
        <button class="btn glow" id="enrolBtn">Enrol / Load</button>
        <button class="btn" id="refreshStatusBtn">Refresh status</button>
      </div>

      <hr class="sep"/>

      <div class="card-title">Task Agreement Import</div>
      <div class="muted">Upload your NWU Task Agreement (.xlsx).</div>
      <div class="row" style="margin-top:10px;">
        <input type="file" id="taFile" accept=".xlsx"/>
        <button class="btn glow" id="taUploadBtn">Import TA</button>
        <span class="pill" id="taPill">No TA imported</span>
      </div>

      <!-- Year timeline: visual progress across months -->
      <div id="yearTimelineContainer" style="margin-top:12px;">
        <div class="card-title">Year Progress</div>
        <div class="muted">Visual overview of months completed. Click a month to focus.</div>
        <div id="yearTimeline" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
          <!-- Timeline months will be injected here by app.js -->
        </div>
      </div>
    </div>
  </section>

  <!-- EXPECTATIONS -->
  <section class="panel" id="tab-expectations">
    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">Monthly Expectations</div>
          <div class="muted">Track progress month-by-month across all KPAs.</div>
        </div>
        <div class="right" style="display:flex;gap:8px;align-items:center;">
          <button class="btn" id="scanEvidenceBtn" title="Scan and link evidence to tasks">üìé Scan Evidence</button>
          <button class="btn glow" id="rebuildExpBtn">Rebuild Expectations</button>
        </div>
      </div>

      <!-- Scan Evidence Modal/Section (initially hidden) -->
      <div id="scanEvidenceSection" style="display:none;margin-top:16px;padding:16px;background:var(--panel-dark);border-radius:8px;border:2px solid var(--purple);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
          <h4 style="margin:0;color:var(--purple);">üìé Scan Evidence Files</h4>
          <button class="btn-small" id="closeScanSection">‚úï Close</button>
        </div>
        <input type="hidden" id="scanTargetTaskId" value="" />
        <div id="scanTargetTaskLabel" class="muted" style="margin-bottom:10px;display:none;">
          Target task: <span style="color:var(--purple);font-weight:bold;" id="scanTargetTaskText"></span>
        </div>
        <div class="form grid2" style="margin-bottom:12px;">
          <div>
            <label>Select Files (multi-select)</label>
            <input type="file" id="scanFiles" multiple accept=".pdf,.docx,.txt,.xlsx,.pptx"/>
          </div>
          <div>
            <label>Month bucket</label>
            <input id="scanMonth" value="2025-01" placeholder="YYYY-MM"/>
            <div class="row" style="margin-top:6px;">
              <label class="chk"><input type="checkbox" id="scanUseBrain" checked/> Use NWU Brain</label>
              <label class="chk"><input type="checkbox" id="scanUseContextual" checked/> Use Ollama</label>
            </div>
            <div class="row" style="margin-top:6px;">
              <label class="chk" title="When enabled, bypasses AI classification and directly links evidence to selected task with 100% confidence">
                <input type="checkbox" id="scanLockToTask"/> üîí Lock to selected task (asserted relevance)
              </label>
            </div>
          </div>
        </div>
        <div class="row" style="margin-top:12px;">
          <button class="btn glow" id="scanUploadBtn">Upload & Scan Files</button>
          <button class="btn" id="scanStopBtn">Stop</button>
          <span class="pill" id="scanProgress" style="margin-left:10px;">‚Äî</span>
          <span class="pill" id="scanStatus" style="margin-left:10px;">Idle</span>
        </div>
        <div class="box" style="margin-top:12px;">
          <div class="box-h">Activity log</div>
          <pre class="log" id="scanLog">Ready to scan evidence files‚Ä¶</pre>
        </div>
      </div>

      <div class="form grid2">
        <div>
          <label>Current Month</label>
          <select id="currentMonthSelect">
            <option value="2025-01">January 2025</option>
            <option value="2025-02">February 2025</option>
            <option value="2025-03">March 2025</option>
            <option value="2025-04">April 2025</option>
            <option value="2025-05">May 2025</option>
            <option value="2025-06">June 2025</option>
            <option value="2025-07">July 2025</option>
            <option value="2025-08">August 2025</option>
            <option value="2025-09">September 2025</option>
            <option value="2025-10">October 2025</option>
            <option value="2025-11">November 2025</option>
            <option value="2025-12">December 2025</option>
          </select>
        </div>
        <div class="row" style="align-items:flex-end;">
          <button class="btn glow" id="checkMonthStatusBtn">Check Month Status</button>
          <span class="pill" id="monthStatusPill">‚Äî</span>
        </div>
      </div>

      <!-- Monthly KPA Expectations (Collapsible) -->
      <div id="monthlyExpectationsContainer" style="margin-top:16px;">
        <div class="muted" style="text-align:center;padding:20px;">
          Import a Task Agreement to see monthly expectations.
        </div>
      </div>

      <div class="box" style="margin-top:12px;">
        <div class="box-h">AI Month Review</div>
        <div class="evidence" id="monthReviewBox">
          Upload evidence for the current month, then click "Check Month Status" to have VAMP assess whether you've met your expectations.
        </div>
      </div>
    </div>
  </section>



  <!-- EVIDENCE LOG -->
  <section class="panel" id="tab-evidence">
    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">Evidence Log</div>
          <div class="muted">All scanned evidence files with task assignments and impact assessments.</div>
        </div>
        <div class="right">
          <div class="row" style="gap:8px;">
            <label>Filter Month:</label>
            <select id="evidenceMonthFilter" style="padding:4px 8px;">
              <option value="all">All Months</option>
              <option value="2025-01">January 2025</option>
              <option value="2025-02">February 2025</option>
              <option value="2025-03">March 2025</option>
              <option value="2025-04">April 2025</option>
              <option value="2025-05">May 2025</option>
              <option value="2025-06">June 2025</option>
              <option value="2025-07">July 2025</option>
              <option value="2025-08">August 2025</option>
              <option value="2025-09">September 2025</option>
              <option value="2025-10">October 2025</option>
              <option value="2025-11">November 2025</option>
              <option value="2025-12">December 2025</option>
            </select>
            <button class="btn glow" id="evidenceReloadBtn">Reload</button>
          </div>
        </div>
      </div>
      
      <!-- Evidence Log Table -->
      <div class="table-container" style="margin-top:16px;">
        <table class="vamp-table" id="evidenceLogTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>File Name</th>
              <th>KPA Assigned</th>
              <th>Month</th>
              <th>Task</th>
              <th>Tier</th>
              <th>Impact Assessment</th>
              <th>Confidence</th>
            </tr>
          </thead>
          <tbody id="evidenceLogTableBody">
            <tr><td colspan="8" class="no-data">No evidence logged yet. Use "Scan Evidence" in the Expectations tab.</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- REPORTS -->
  <section class="panel" id="tab-reports">
    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">Reports & PA Generation</div>
          <div class="muted">View full expectations and generate Performance Agreement.</div>
        </div>
        <div class="right">
          <button class="btn glow" id="genPABtn">Generate Final PA</button>
        </div>
      </div>

      <!-- PA Report Table -->
      <div class="table-container" style="margin-top:16px;">
        <h3 style="margin-bottom:8px;color:var(--purple);">Performance Agreement Report</h3>
        <table class="vamp-table" id="paExpectationsTable">
          <thead>
            <tr>
              <th>KPA Name</th>
              <th>Outputs</th>
              <th>KPIs</th>
              <th>Weight (%)</th>
              <th>Hours</th>
              <th>Outcomes</th>
              <th>Active</th>
            </tr>
          </thead>
          <tbody id="paExpectationsTableBody">
            <tr><td colspan="7" class="no-data">Click "Generate Final PA" to create report.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="box" style="margin-top:16px;">
        <div class="box-h">PA Generation Output</div>
        <div class="evidence" id="reportBox">Click "Generate Final PA" to create your Performance Agreement document.</div>
      </div>
    </div>
  </section>

  <!-- VOICE SETTINGS -->
  <section class="panel" id="tab-voice">
    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">üéôÔ∏è Voice Settings</div>
          <div class="muted">Configure OpenVoice V2 voice cloning for VAMP</div>
        </div>
      </div>

      <!-- Voice Status -->
      <div class="box info" id="voiceStatusBox">
        <div class="box-h">Voice Status</div>
        <div id="voiceStatusContent">Checking voice system...</div>
      </div>

      <!-- Upload Voice Samples -->
      <div class="box" style="margin-top:16px;">
        <div class="box-h">üì§ Upload Voice Samples</div>
        <p style="margin-bottom:12px;color:var(--text);">
          Upload 3-5 audio files (WAV, MP3, FLAC) with clear speech from the voice you want to clone.
          Each file should be 5-30 seconds of clear, high-quality speech.
        </p>
        <input type="file" id="voiceSampleInput" accept=".wav,.mp3,.flac,.m4a,.ogg" multiple style="margin-bottom:12px;"/>
        <button class="btn" id="uploadVoiceSampleBtn">Upload Voice Sample(s)</button>
        <div id="voiceUploadStatus" style="margin-top:8px;"></div>
      </div>

      <!-- Train Voice -->
      <div class="box warning" style="margin-top:16px;">
        <div class="box-h">üéØ Train Voice Model</div>
        <p style="margin-bottom:12px;color:var(--text);">
          After uploading voice samples, click below to train the voice cloning model.
          This may take a few minutes.
        </p>
        <button class="btn glow" id="trainVoiceBtn">Train Voice Model</button>
        <div id="voiceTrainStatus" style="margin-top:8px;"></div>
      </div>

      <!-- Voice Test -->
      <div class="box success" style="margin-top:16px;">
        <div class="box-h">üîä Test Voice</div>
        <p style="margin-bottom:12px;color:var(--text);">
          Test the cloned voice with sample text.
        </p>
        <textarea id="voiceTestText" rows="3" placeholder="Enter text to test voice synthesis..." style="width:100%;margin-bottom:12px;">Hello! This is VAMP, your Virtual Academic Management Partner. I'm here to help you with your performance management.</textarea>
        <button class="btn glow" id="testVoiceBtn">Generate Test Speech</button>
        <div id="voiceTestPlayer" style="margin-top:12px;"></div>
      </div>

      <!-- Voice Info -->
      <div class="box" style="margin-top:16px;">
        <div class="box-h">‚ÑπÔ∏è About Voice Cloning</div>
        <p style="color:var(--text);line-height:1.6;">
          <strong>OpenVoice V2</strong> (MIT License) allows VAMP to speak with a natural, cloned voice.<br><br>
          <strong>Requirements:</strong><br>
          ‚Ä¢ 3-5 audio samples of clear speech (5-30 seconds each)<br>
          ‚Ä¢ GPU recommended for faster processing (CPU works but is slower)<br>
          ‚Ä¢ Training takes 1-5 minutes depending on hardware<br><br>
          <strong>Privacy:</strong> All voice processing happens locally. Voice models never leave your system.
        </p>
      </div>
    </div>
  </section>

  <!-- LOGS -->
  <section class="panel" id="tab-logs">
    <div class="card">
      <div class="card-h">
        <div>
          <div class="card-title">Logs</div>
          <div class="muted">Client-side log console.</div>
        </div>
      </div>
      <pre class="log" id="appLog"></pre>
    </div>
  </section>

</div>

<!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
     MODALS
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

<!-- AI Guidance Modal -->
<div id="aiGuidanceModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>AI Guidance</h2>
      <button class="modal-close" onclick="closeModal('aiGuidanceModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-section">
        <label>Task Context</label>
        <div id="aiTaskContext" class="modal-info"></div>
      </div>
      <div class="modal-section">
        <label>Your Question</label>
        <textarea id="aiGuidanceInput" rows="3" placeholder="Ask VAMP for guidance on this task‚Ä¶"></textarea>
      </div>
      <div class="modal-section" id="aiGuidanceResponse" style="display:none;">
        <label>VAMP's Guidance</label>
        <div class="modal-response"></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal('aiGuidanceModal')">Cancel</button>
      <button class="btn glow" id="submitGuidanceBtn">Ask VAMP</button>
    </div>
  </div>
</div>

<!-- Resolve Classification Modal -->
<div id="resolveModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Resolve Classification</h2>
      <button class="modal-close" onclick="closeModal('resolveModal')">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-section">
        <label>File</label>
        <div id="resolveFileName" class="modal-info"></div>
      </div>
      <div class="modal-section">
        <label>AI's Initial Classification</label>
        <div id="resolveInitialClass" class="modal-info warning"></div>
      </div>
      <div class="modal-section">
        <label>Select Correct KPA</label>
        <select id="resolveKpaSelect" class="modal-select">
          <option value="">-- Choose KPA --</option>
          <option value="teaching_learning">Teaching & Learning</option>
          <option value="research">Research</option>
          <option value="community_engagement">Community Engagement</option>
          <option value="innovation_impact">Innovation & Impact</option>
          <option value="leadership_management">Leadership & Management</option>
        </select>
      </div>
      <div class="modal-section">
        <label>Explain the Link</label>
        <textarea id="resolveExplanation" rows="4" placeholder="Describe how this evidence relates to the chosen KPA‚Ä¶"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal('resolveModal')">Cancel</button>
      <button class="btn glow" id="submitResolveBtn">Resolve & Save</button>
    </div>
  </div>
</div>

<!-- VAMP Thinking Overlay -->
<div id="vampThinking" class="vamp-overlay" style="display:none;">
  <div class="vamp-overlay-content">
    <div class="vamp-spinner"></div>
    <div class="vamp-overlay-text" id="vampThinkingText">Analysing‚Ä¶</div>
  </div>
</div>

<script src="./app.js?v=20251217"></script>
</body>
</html>
